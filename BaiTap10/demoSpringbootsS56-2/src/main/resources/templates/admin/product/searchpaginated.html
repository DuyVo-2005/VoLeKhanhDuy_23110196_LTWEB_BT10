<!doctype html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{admin/layout-admin.html}">
<head>
<title>List</title>
</head>
<body>
	<section class="row" layout:fragment="content">
		<div class="col-md-12">
			<div class="card">
				<div class="card-header">List Product</div>
				<div class="card-body">

					<!-- Hiển thị thông báo -->
					<div th:if="${message != null}" class="alert alert-primary"
						role="alert">
						<i>[[${message}]]</i>
					</div>

					<!-- Form tìm kiếm -->
					<div class="row mt-2 mb-2">
						<div class="col-md-6">
							<form th:action="@{/admin/product/searchpaginated}" method="get">
								<div class="input-group">
									<input type="text" class="form-control ml-2" name="name"
										id="name" placeholder="Nhập từ khóa để tìm" th:value="${name}" />
									<button class="btn btn-outline-primary ml-2">Search</button>
								</div>
							</form>
						</div>

						<div class="col-md-6">
							<div class="float-right">
								<a class="btn btn-outline-success"
									th:href="@{/admin/product/add}">Add New Product</a> <a
									class="btn btn-outline-success" th:href="@{/admin/product}">Manage
									Product</a>
							</div>
						</div>
					</div>

					<!-- Nếu không có dữ liệu -->
					<div class="row" th:if="${!productPage.hasContent()}">
						<div class="col">
							<div class="alert alert-danger" role="alert">No Product
								Found</div>
						</div>
					</div>

					<!-- Bảng dữ liệu -->
					<table th:if="${productPage.hasContent()}"
						class="table table-striped table-inverse table-responsive">
						<thead class="thead-inverse">
							<tr>
								<th>Product ID</th>
								<th>Product Name</th>
								<th>Unit Price</th>
								<th>Username</th>
								<th>Action</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="product : ${productPage.content}">
								<td scope="row" th:text="${product.productId}"></td>
								<td th:text="${product.name}"></td>
								<td th:text="${product.unit_price}"></td>
								<td th:text="${product.user.username}"></td>
								<td><a
									th:href="@{/admin/product/view/{id}(id=${product.productId})}"
									class="btn btn-outline-info"><i class="fa fa-info"></i></a> <a
									th:href="@{/admin/product/edit/{id}(id=${product.productId})}"
									class="btn btn-outline-warning"><i class="fa fa-edit"></i></a>
									<a href="javascript:void(0)"
									th:attr="data-id=${product.productId}, data-name=${product.name}"
									onclick="showConfirmation(this)" class="btn btn-outline-danger"><i
										class="fa fa-trash"></i></a></td>
							</tr>
						</tbody>
					</table>

					<!-- Phân trang -->
					<div class="card-footer text-muted">
						<div class="row">
							<!-- Chọn size -->
							<div class="col-3">
								<form th:action="@{/admin/product/searchpaginated}"
									method="get">
									<input type="hidden" name="name" th:value="${name}" /> <input
										type="hidden" name="page"
										th:value="${productPage.number + 1}" />
									<div class="mb-3 input-group float-left">
										<label for="size" class="mr-2">Page size:</label> <select
											class="form-select ml-2" name="size" id="size"
											onchange="this.form.submit()">
											<option th:value="3" th:selected="${productPage.size == 3}">3</option>
											<option th:value="5" th:selected="${productPage.size == 5}">5</option>
											<option th:value="10"
												th:selected="${productPage.size == 10}">10</option>
											<option th:value="15"
												th:selected="${productPage.size == 15}">15</option>
											<option th:value="20"
												th:selected="${productPage.size == 20}">20</option>
										</select>
									</div>
								</form>
							</div>

							<!-- Page navigation -->
							<div class="col-7">
								<nav aria-label="Page navigation"
									th:if="${productPage.totalPages > 0}">
									<ul class="pagination justify-content-center">
										<!-- First -->
										<li class="page-item"
											th:classappend="${1 == productPage.number + 1} ? 'active' : ''">
											<a
											th:href="@{/admin/product/searchpaginated(name=${name},size=${productPage.size},page=1)}"
											class="page-link">First</a>
										</li>

										<!-- Page numbers -->
										<li th:each="pageNumber : ${pageNumbers}" class="page-item"
											th:classappend="${pageNumber == productPage.number + 1} ? 'active' : ''">
											<a
											th:href="@{/admin/product/searchpaginated(name=${name},size=${productPage.size},page=${pageNumber})}"
											class="page-link" th:text="${pageNumber}"></a>
										</li>

										<!-- Last -->
										<li class="page-item"
											th:classappend="${productPage.totalPages == productPage.number + 1} ? 'active' : ''">
											<a
											th:href="@{/admin/product/searchpaginated(name=${name},size=${productPage.size},page=${productPage.totalPages})}"
											class="page-link">Last</a>
										</li>
									</ul>
								</nav>
							</div>
						</div>
					</div>

					<!-- Modal xác nhận -->
					<div class="modal fade" id="confirmationId" tabindex="-1"
						aria-labelledby="confirmationLabel" aria-hidden="true">
						<div class="modal-dialog" role="document">
							<div class="modal-content">
								<div class="modal-header">
									<h5 class="modal-title" id="confirmationLabel">Confirmation</h5>
									<button type="button" class="btn-close" data-bs-dismiss="modal"
										aria-label="Close"></button>
								</div>
								<div class="modal-body">
									Bạn có chắc muốn xóa <b><span id="productName"></span></b>?
								</div>
								<div class="modal-footer">
									<!-- Nút Yes được JS gán href động -->
									<a id="yesOption" href="#" class="btn btn-danger">Yes</a>
									<button type="button" class="btn btn-secondary"
										data-bs-dismiss="modal">Close</button>
								</div>
							</div>
						</div>
					</div>

					<!-- Script -->
					<script type="text/javascript">
						function showConfirmation(el) {
							var id = el.getAttribute("data-id");
							var name = el.getAttribute("data-name");

							// Hiển thị tên product
							document.getElementById("productName").innerText = name;

							// Gán link xóa động
							document.getElementById("yesOption").setAttribute(
									"href", '/admin/product/delete/' + id);

							// Hiện modal (Bootstrap 5)
							var modal = new bootstrap.Modal(document
									.getElementById('confirmationId'));
							modal.show();
						}
					</script>

					<!-- Bootstrap Bundle (bao gồm Popper) -->
					<script
						src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

				</div>
			</div>
		</div>
	</section>
</body>
</html>